<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>burak.wtf — ring breathe (single)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
  :root { color-scheme: dark; }
  html, body { margin:0; padding:0; height:100%; background:#000; }
  body { display:flex; align-items:center; justify-content:center; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:#fff; user-select:none; }
  canvas.stage { position:fixed; inset:0; touch-action:none; }
  .bottom { position:fixed; left:0; right:0; bottom:0; background:rgba(0,0,0,.55); backdrop-filter:blur(8px); border-top:1px solid rgba(255,255,255,.15); padding:8px 10px; display:grid; gap:8px; z-index:2; }
  .sections { display:grid; grid-template-columns:repeat(2,minmax(280px,1fr)); gap:8px; }
  @media (max-width: 820px){ .sections { grid-template-columns:1fr; } }
  details { border:1px solid rgba(255,255,255,.15); border-radius:10px; overflow:clip; background:rgba(255,255,255,.04); }
  summary { list-style:none; cursor:pointer; padding:8px 10px; font-size:12px; letter-spacing:.02em; display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,.05); }
  summary::-webkit-details-marker{ display:none; }
  .caret{ opacity:.7; transition: transform .2s ease; } details[open] .caret{ transform: rotate(90deg); }
  .content { padding:8px 10px; } .grid3 { display:grid; gap:10px 12px; grid-template-columns:auto 1fr auto; align-items:center; }
  .label { opacity:.85; white-space:nowrap; font-size:12px; }
  input[type="range"] { width:100%; touch-action: pan-y; }
  .val { font-variant-numeric: tabular-nums; opacity:.85; font-size:12px; }
  .row { grid-column:1/-1; display:flex; align-items:center; gap:12px; flex-wrap:wrap; font-size:12px; opacity:.9; }
  </style>
</head>
<body>
  <canvas id="stage" class="stage"></canvas>
  <div id="panel" class="bottom">
    <div class="sections">
      <details id="shapeSec" open>
        <summary>Shape <span class="caret">▶</span></summary>
        <div class="content grid3">
          <div class="label">gain high</div><input id="ghi" type="range" min="0" max="240" step="0.1" value="7.7"><div id="ghiVal" class="val">7.7</div>
          <div class="label">gain low</div><input id="glo" type="range" min="0" max="100" step="0.1" value="0.3"><div id="gloVal" class="val">0.3</div>
          <div class="label">moons (0–7)</div><input id="moonCount" type="range" min="0" max="7" step="1" value="3"><div id="moonCountVal" class="val">3</div>
          <div class="label">min radius (% exhale)</div><input id="sizeMin" type="range" min="2" max="90" step="1" value="12"><div id="sizeMinVal" class="val">12%</div>
          <div class="label">max radius (% inhale)</div><input id="sizeMax" type="range" min="5" max="95" step="1" value="66"><div id="sizeMaxVal" class="val">66%</div>
          <div class="label">base shift (±%)</div><input id="sizeBase" type="range" min="-40" max="40" step="1" value="0"><div id="sizeBaseVal" class="val">0%</div>
        </div>
      </details>
      <details id="breatheSec" open>
        <summary>Breathe <span class="caret">▶</span></summary>
        <div class="content grid3">
          <div class="label">inhale (s)</div><input id="tin" type="range" min="0.1" max="120" step="0.1" value="3"><div id="tinVal" class="val">3.0</div>
          <div class="label">hold in (s)</div><input id="thold" type="range" min="0" max="60" step="0.1" value="2"><div id="tholdVal" class="val">2.0</div>
          <div class="label">exhale (s)</div><input id="tout" type="range" min="0.1" max="120" step="0.1" value="7"><div id="toutVal" class="val">7.0</div>
          <div class="label">hold out (s)</div><input id="bhold" type="range" min="0" max="60" step="0.1" value="1.5"><div id="bholdVal" class="val">1.5</div>
          <div class="row"><label><input id="holdInChk" type="checkbox" checked> Hold In aktif</label><label><input id="holdOutChk" type="checkbox" checked> Hold Out aktif</label></div>
          <div class="row"><label style="display:flex;align-items:center;gap:8px;"><input id="rationalChk" type="checkbox"> rational breathing</label><div id="ratInfo"></div></div>
          <div class="label">units (0–57)</div><input id="rationalUnits" type="range" min="0" max="57" step="1" value="1" disabled><div id="rationalVal" class="val">1</div>
        </div>
      </details>
    </div>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";

    // ---- ring shader ----
    function initRing(scene){
      const PLANE_SIZE = 2.9;
      const planeGeo = new THREE.PlaneGeometry(PLANE_SIZE, PLANE_SIZE, 1, 1);
      const COLOR = '#FFD75A';
      const mat = new THREE.ShaderMaterial({
        transparent:true, depthWrite:false, blending:THREE.AdditiveBlending,
        uniforms:{ uTime:{value:0}, uRadius:{value:0.42}, uWidth:{value:3.2}, uGain:{value:1.0}, uAlpha:{value:1.0}, uColor:{value:new THREE.Color(COLOR)} },
        vertexShader:`varying vec2 vUv; void main(){ vUv=uv; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0); }`,
        fragmentShader:`precision highp float; varying vec2 vUv; uniform float uTime,uRadius,uWidth,uGain,uAlpha; uniform vec3 uColor;
          void main(){ vec2 p = vUv - 0.5; float r = length(p) * 2.0;
            float inner = 1.0 - smoothstep(uRadius - (1.0/uWidth), uRadius, r);
            float outer = smoothstep(uRadius, uRadius + (0.9/uWidth), r);
            float ring  = inner * (1.0 - outer);
            float a = ring * uGain * uAlpha;
            vec3  c = uColor * (0.98 + 0.02*sin(uTime*2.0));
            gl_FragColor = vec4(c*a, a);
            if(gl_FragColor.a < 0.001) discard; }`
      });
      const mesh = new THREE.Mesh(planeGeo, mat);
      mesh.renderOrder = 2;
      const group = new THREE.Group();
      group.add(mesh);
      scene.add(group);
      return Object.assign(mat, { planeSize: PLANE_SIZE, mesh, group, uniforms: mat.uniforms });
    }

    function computeBreathGain(t, tin, thold, tout, bhold, lo, hi){
      tin=Math.max(0,tin); thold=Math.max(0,thold); tout=Math.max(0,tout); bhold=Math.max(0,bhold);
      const T = tin + thold + tout + bhold;
      if (T < 1e-6) return (lo+hi)*0.5;
      const ph = t % T;
      if (ph < tin){ const u=ph/tin; return lo + (hi-lo)*u; }
      if (ph < tin + thold){ return hi; }
      if (ph < tin + thold + tout){ const u=(ph - (tin+thold)) / tout; return hi + (lo - hi)*u; }
      return lo;
    }

    // minimal moons off for single-file simplicity

    const canvas = document.getElementById('stage');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.setClearColor(0x000000, 1);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.01, 100);
    camera.position.set(0,0,3);
    const ring = initRing(scene);

    const ui = {
      el: (id)=>document.getElementById(id),
      ghi: ()=>+ghi.value, glo: ()=>+glo.value,
      sizeMin: ()=>+sizeMin.value, sizeMax: ()=>+sizeMax.value, sizeBase: ()=>+sizeBase.value,
      tin: ()=>+tin.value, thold: ()=>+thold.value, tout: ()=>+tout.value, bhold: ()=>+bhold.value,
      holdInOn: ()=>holdInChk.checked, holdOutOn: ()=>holdOutChk.checked,
      rationalOn: ()=>rationalChk.checked, rationalUnits: ()=>+rationalUnits.value
    };

    function fracToURadius(frac, distance, uWidth, planeSize){
      const h = 2 * distance * Math.tan(THREE.MathUtils.degToRad(camera.fov * 0.5));
      const w = h * camera.aspect;
      const targetWorldDia = frac * Math.min(w,h);
      const edge = 0.9 / uWidth;
      return Math.max(0.02, (targetWorldDia / planeSize) - edge);
    }

    let yaw=0,pitch=0,dist=3;
    canvas.addEventListener('wheel',(e)=>{ dist+=Math.sign(e.deltaY)*0.15; dist=Math.max(1.4,Math.min(6.0,dist)); },{passive:true});

    const clock = new THREE.Clock();
    function tick(){
      const t = clock.getElapsedTime();
      const dt = clock.getDelta();

      const q = new THREE.Quaternion().setFromEuler(new THREE.Euler(pitch, yaw, 0));
      const v = new THREE.Vector3(0,0,1).applyQuaternion(q).multiplyScalar(dist);
      camera.position.copy(v);
      camera.lookAt(0,0,0);

      let tin = ui.tin(), thold = ui.thold(), tout = ui.tout(), bhold = ui.bhold();
      const lo = ui.glo(), hi = ui.ghi();
      let gBreath = computeBreathGain(t, tin, thold, tout, bhold, lo, hi);
      const breathU = THREE.MathUtils.clamp((gBreath - lo) / Math.max(1e-6, (hi - lo)), 0, 1);

      const baseShift = ui.sizeBase()/100;
      const fLo = Math.max(0.02, Math.min(0.95, Math.min(ui.sizeMin(), ui.sizeMax())/100 + baseShift));
      const fHi = Math.max(0.02, Math.min(0.95, Math.max(ui.sizeMin(), ui.sizeMax())/100 + baseShift));

      const uMin = fracToURadius(fLo, dist, ring.uniforms.uWidth.value, ring.planeSize);
      const uMax = fracToURadius(fHi, dist, ring.uniforms.uWidth.value, ring.planeSize);
      const uRadiusTarget = THREE.MathUtils.lerp(uMin, uMax, breathU);

      ring.uniforms.uRadius.value += (uRadiusTarget - ring.uniforms.uRadius.value) * (1.0 - Math.exp(-6*dt));
      ring.uniforms.uGain.value = gBreath;
      ring.uniforms.uTime.value = t;

      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();

    addEventListener('resize', ()=>{
      renderer.setSize(innerWidth, innerHeight);
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
    });
  </script>
</body>
</html>
